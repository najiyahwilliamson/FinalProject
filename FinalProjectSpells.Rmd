---
title: "Final Project Spells"
author: "Najiyah Williamson"
date: "2025-09-29"
output: html_document
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

# Introduction

For this analysis, I will be working with the Spell subset of the Harry Potter Movies dataset, sourced from Kaggle. This subset contains 61 spells featured across the Harry Potter films, with detailed attributes including the spell name, incantation, effect, and the color of light produced during its use.

Given that all columns contain categorical data, my analysis will focus on descriptive and comparative techniques suitable for qualitative variables. Specifically, I plan to:

* Explore frequency distributions of spell types (e.g., charms, curses, jinxes) based on the Spell.Name column, using bar plots and proportion tables to highlight dominant categories.
* Investigate associations between spell type and light color using contingency tables and chi-square tests of independence to assess whether certain categories of spells tend to produce specific colors.


```{r, loading-data, echo = TRUE}
here::i_am("Harry Potter/Final Project Spells.Rmd")

data <- read.csv("Spells.csv")
```

# Frequency of Spell Type

```{r}
library(tidyverse)
library(ggplot2)
library(kableExtra)

data <- data %>%
  mutate(Spell.Category = case_when(
    grepl("charm|water-making spell|locking spell|general counter-spell|fire-making spell|dissendium|Human Presence Revealing Spell|lumos|protego maxima|protego totalum|Repello Inimicum", Spell.Name, ignore.case = TRUE) ~ "Charm",
    grepl("curse|sectumsempra", Spell.Name, ignore.case = TRUE) ~ "Curse",
    grepl("jinx|levicorpus|stunning spell", Spell.Name, ignore.case = TRUE) ~ "Jinx",
    grepl("episkey|brackium emendo", Spell.Name, ignore.case = TRUE) ~ "Healing",
    grepl("piertotum locomotor|snake summons spell|vera verto|incarcerous spell",
          Spell.Name, ignore.case = TRUE) ~ "Transfiguration\nand Conjuring",
    TRUE ~ "Other"
  )) 

#Frequency of categories
freq_cat <- data %>%
  count(Spell.Category, sort = TRUE)

# Make character
freq_cat$Spell.Category <- as.character(freq_cat$Spell.Category)

# All categories in desired order
all_categories <- c("Charm", "Healing", "Curse", "Jinx", "Other",
                    "Transfiguration\nand Conjuring")

# Complete missing categories (if any) and reorder
freq_cat <- freq_cat %>%
  complete(Spell.Category = all_categories, fill = list(n = 0)) %>%
  arrange(match(Spell.Category, all_categories))

```


```{r}
kable(freq_cat, caption = "Frequency of Spell Categories", align = "c") %>%
  kable_styling(position = "center", full_width = FALSE) #Formatting to make a table in HTML report
```
Charms are by far the most common type of spell in this dataset, with 32 occurrences. “Other” spells come next with 10, followed by Curses (8), Jinxes (5), and Transfiguration and Conjuring spells (4). Healing spells are the least frequent, appearing only twice. This is somewhat surprising given the frequent injuries seen in the movies, but it may reflect that potions and other non-spell methods are primarily used for healing rather than magical spells.

```{r spell-plot, fig.align='center', echo=FALSE} 
#Bar plot of categories
ggplot(freq_cat,
       aes(x = factor(Spell.Category, 
                    levels = c("Charm", "Healing", "Curse", "Jinx",
                                "Transfiguration\nand Conjuring", "Other")),
           y = n, fill = Spell.Category)) +
 geom_bar(stat = "identity") +
 labs(title = "Spells by Category",
      x = NULL,
      y = "Count",
      fill = "Category") +   # <-- Legend label
  theme_minimal() +
   theme(axis.text.x = element_blank(),   # remove x-axis tick labels
      axis.ticks.x = element_blank()) # remove little ticks too
```

The figure illustrates the distribution of spell categories in the dataset. Charms dominate the dataset, followed by a smaller number of “Other” spells, Curses, Jinxes, and Transfiguration and Conjuring spells. Healing spells are the least frequent category, appearing only rarely.

```{r spell-plot3, fig.align='center', include = FALSE}
# Reclassify categories
freq_cat <- freq_cat %>%
  mutate(Category_Group = case_when(
    Spell.Category %in% c("Charm", "Healing") ~ "Non-Dark Magic",
    Spell.Category %in% c("Curse", "Jinx") ~ "Dark Magic",
    Spell.Category %in% c("Transfiguration\nand Conjuring", "Other") ~ "Other"
  ))

# Summarize counts by new group
freq_grouped <- freq_cat %>%
  group_by(Category_Group) %>%
  summarise(n = sum(n))

# Plot
ggplot(freq_grouped, aes(x = Category_Group, y = n, fill = Category_Group)) +
  geom_bar(stat = "identity") +
  labs(title = "Spells by Broader Type",
       x = NULL,
       y = "Count",
       fill = "Broader Spell Type") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank())
```

# Spell Type and Color
```{r echo = FALSE}
library(dplyr)
library(ggplot2)
library(kableExtra)

# Keep only complete cases for the two columns
data_complete <- data %>%
  filter(!is.na(Spell.Category) & !is.na(Light) & Light != "") %>%
  droplevels()  # remove unused factor levels

#Contingency table
contingency_table <- table(data_complete$Spell.Category, data_complete$Light)

# Count how many times each color appears
color_freq <- data_complete %>%
  count(Light, sort = TRUE)

```

```{r echo = FALSE}
#Chi-squared test
chi_test <- chisq.test(contingency_table)
```
```{r}
library(dplyr)
library(kableExtra)

# Summarize by color: list spells and incantations for each color
color_summary <- data_complete %>%
  filter(Light != "") %>%
  group_by(Light) %>%
  summarise(
   Count = n(),
   Incantations = paste(Incantation, collapse = ", "),
   Spells = paste(Spell.Name, collapse = ", ")
  ) %>%
  arrange(desc(Count))

# Show as a nice HTML table
kable(color_summary, caption = "Spell Colors with Names and Incantations", align = "c") %>%
  kable_styling(position = "center", full_width = FALSE)
```

This summarizes the 40 spells in the dataset that have an associated light color. Overall, Blue and White are the most frequently occurring colors, each appearing 7 times, followed by Green and Red, each appearing 4 times. Purple occurs 3 times, Haze, Icy Blue, and Silver appear twice each, and the remaining colors—Black smoke, Bright Yellow, Crystal Clear, Fiery Orange, Gold, Light Green, Orange, Scarlet, and Turquoise—appear only once.

Each row lists the spells that produce the given color along with their incantations, providing a detailed look at the types of magic associated with each hue. For example, Blue includes spells like Alohomora (Unlocking Charm) and Portus, while White encompasses spells such as Lumos Maxima (Wand-Lighting Charm) and Protego Maxima. This table highlights that certain colors, particularly Blue and White, are more common in the magical light effects of spells, whereas many colors are unique to a single spell.

```{r spell-plot4, fig.align='center', echo=FALSE}
#Bar Plot
library(scales)

#Ensure Spell.Category is a factor with desired order
data$Spell.Category <- factor(data$Spell.Category,
                              levels = c("Charm", "Healing", "Curse", "Jinx",
                                         "Transfiguration\nand Conjuring", "Other"))

#Define colors to match light names
color_mapping <- c(
    "Black smoke" = "#000000",  # black
  "Blue" = "#1E90FF",         # dodger blue
  "Bright yellow" = "#FFFF00",# yellow
  "Crystal clear" = "#E0FFFF",# light cyan
  "Fiery Orange" = "#FF4500",        # orange red
  "Orange" = "#FFA500",       # bright orange
  "Gold" = "#FFD700",         # gold
  "Green" = "#32CD32",        # lime green
  "Haze" = "#87CEEB",         # sky blue
  "Icy blue" = "#00CED1",     # dark turquoise
  "Light green" = "#7CFC00",  # lawn green
  "Purple" = "orchid4",       # dark violet
  "Red" = "red3",    # red
  "Scarlet" = "red",       # scarlet
  "Silver" = "#C0C0C0",        # silver
  "Turquoise" = "#40E0D0",     # turquoise
  "White" = "antiquewhite2"           # white (optional: add border so it shows)
)

# Create stacked bar plot with manual colors
ggplot(data_complete, aes(x = Spell.Category, fill = Light)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = color_mapping) +
  labs(title = "Distribution of Emitted Colors by Spell Type",
       x = NULL,
       y = "Percentage",
       fill = "Color Emitted") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5)
  )

```

The figure shows the distribution of light colors produced by different spell types. Charms are the most common spell type and produce a wide variety of colors, with blue and white being among the most frequent. Other spell types, such as Curses, Jinxes, Healing, Transfiguration, and “Other” spells, show more limited color distributions.

A chi-square test of independence was conducted to assess whether the distribution of colors emitted from wands differs by spell type. The test results (X-squared = 63.428, df = 80, p-value = 0.913) indicate no statistically significant association between spell type and color emitted. This suggests that, in this dataset, emitted color is generally independent of the type of spell cast, even though some spell types appear more frequently overall.
